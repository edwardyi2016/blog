<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发实战总结 | YupaiTS的博客</title>
    <meta name="description" content="俯仰一生，最惧无为。">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.65ac630d.css" as="style"><link rel="preload" href="/assets/js/app.714fd557.js" as="script"><link rel="preload" href="/assets/js/12.18f8ea25.js" as="script"><link rel="prefetch" href="/assets/js/10.ed7e17a8.js"><link rel="prefetch" href="/assets/js/100.718b8d89.js"><link rel="prefetch" href="/assets/js/101.f58e81bb.js"><link rel="prefetch" href="/assets/js/102.6a5ddaf4.js"><link rel="prefetch" href="/assets/js/103.70755a39.js"><link rel="prefetch" href="/assets/js/104.d61de79e.js"><link rel="prefetch" href="/assets/js/105.1b5b0e10.js"><link rel="prefetch" href="/assets/js/106.acbe47d5.js"><link rel="prefetch" href="/assets/js/107.676afd04.js"><link rel="prefetch" href="/assets/js/108.c489f4e2.js"><link rel="prefetch" href="/assets/js/109.3eed83be.js"><link rel="prefetch" href="/assets/js/11.dccd060f.js"><link rel="prefetch" href="/assets/js/110.d48734f3.js"><link rel="prefetch" href="/assets/js/111.d926a4ee.js"><link rel="prefetch" href="/assets/js/112.1ed92b6b.js"><link rel="prefetch" href="/assets/js/113.75f31f78.js"><link rel="prefetch" href="/assets/js/114.5e707c77.js"><link rel="prefetch" href="/assets/js/115.7478e70a.js"><link rel="prefetch" href="/assets/js/116.d1f5cd7d.js"><link rel="prefetch" href="/assets/js/117.67cc8cf0.js"><link rel="prefetch" href="/assets/js/118.a9448371.js"><link rel="prefetch" href="/assets/js/119.7f547ec5.js"><link rel="prefetch" href="/assets/js/120.2cd8540a.js"><link rel="prefetch" href="/assets/js/121.50ea3cda.js"><link rel="prefetch" href="/assets/js/122.3bb03c6d.js"><link rel="prefetch" href="/assets/js/123.8d02567b.js"><link rel="prefetch" href="/assets/js/124.c5c7b78a.js"><link rel="prefetch" href="/assets/js/125.a348d208.js"><link rel="prefetch" href="/assets/js/126.4e341c1f.js"><link rel="prefetch" href="/assets/js/127.5653d924.js"><link rel="prefetch" href="/assets/js/128.1462fc28.js"><link rel="prefetch" href="/assets/js/129.c95c9e07.js"><link rel="prefetch" href="/assets/js/13.09335dde.js"><link rel="prefetch" href="/assets/js/130.7f3d8b38.js"><link rel="prefetch" href="/assets/js/131.f19b1d14.js"><link rel="prefetch" href="/assets/js/132.8649cd95.js"><link rel="prefetch" href="/assets/js/133.ef937b6b.js"><link rel="prefetch" href="/assets/js/14.0c311189.js"><link rel="prefetch" href="/assets/js/15.5d9a427d.js"><link rel="prefetch" href="/assets/js/16.71482037.js"><link rel="prefetch" href="/assets/js/17.3257fbf3.js"><link rel="prefetch" href="/assets/js/18.07832901.js"><link rel="prefetch" href="/assets/js/19.90da3eb6.js"><link rel="prefetch" href="/assets/js/2.a5dc6ab5.js"><link rel="prefetch" href="/assets/js/20.4f568adf.js"><link rel="prefetch" href="/assets/js/21.e86091d3.js"><link rel="prefetch" href="/assets/js/22.801d41b6.js"><link rel="prefetch" href="/assets/js/23.9ad873fe.js"><link rel="prefetch" href="/assets/js/24.e5827ce8.js"><link rel="prefetch" href="/assets/js/25.b158de9d.js"><link rel="prefetch" href="/assets/js/26.20f59ce1.js"><link rel="prefetch" href="/assets/js/27.9ac71ee7.js"><link rel="prefetch" href="/assets/js/28.31170958.js"><link rel="prefetch" href="/assets/js/29.000574fe.js"><link rel="prefetch" href="/assets/js/3.7b13dfee.js"><link rel="prefetch" href="/assets/js/30.0ab2abcc.js"><link rel="prefetch" href="/assets/js/31.63717031.js"><link rel="prefetch" href="/assets/js/32.3cbdf102.js"><link rel="prefetch" href="/assets/js/33.2b1fc570.js"><link rel="prefetch" href="/assets/js/34.93bef7df.js"><link rel="prefetch" href="/assets/js/35.18f3ad14.js"><link rel="prefetch" href="/assets/js/36.7c408567.js"><link rel="prefetch" href="/assets/js/37.79799a23.js"><link rel="prefetch" href="/assets/js/38.43d55f17.js"><link rel="prefetch" href="/assets/js/39.451d0310.js"><link rel="prefetch" href="/assets/js/4.04df7874.js"><link rel="prefetch" href="/assets/js/40.8c79f5e6.js"><link rel="prefetch" href="/assets/js/41.51117f88.js"><link rel="prefetch" href="/assets/js/42.bdac4bbb.js"><link rel="prefetch" href="/assets/js/43.d7649c1b.js"><link rel="prefetch" href="/assets/js/44.3ec8d30f.js"><link rel="prefetch" href="/assets/js/45.f60f1ed8.js"><link rel="prefetch" href="/assets/js/46.e62a7ea9.js"><link rel="prefetch" href="/assets/js/47.177c1575.js"><link rel="prefetch" href="/assets/js/48.f97fb5ce.js"><link rel="prefetch" href="/assets/js/49.3ecb694f.js"><link rel="prefetch" href="/assets/js/5.9120278c.js"><link rel="prefetch" href="/assets/js/50.4a0df07c.js"><link rel="prefetch" href="/assets/js/51.216c129d.js"><link rel="prefetch" href="/assets/js/52.a513120a.js"><link rel="prefetch" href="/assets/js/53.7e7397fe.js"><link rel="prefetch" href="/assets/js/54.9adc54b4.js"><link rel="prefetch" href="/assets/js/55.9ef03598.js"><link rel="prefetch" href="/assets/js/56.d909302c.js"><link rel="prefetch" href="/assets/js/57.466e0abe.js"><link rel="prefetch" href="/assets/js/58.194bcea2.js"><link rel="prefetch" href="/assets/js/59.ea7f8270.js"><link rel="prefetch" href="/assets/js/6.339b5595.js"><link rel="prefetch" href="/assets/js/60.574aa20c.js"><link rel="prefetch" href="/assets/js/61.db7e823c.js"><link rel="prefetch" href="/assets/js/62.e9f73fe8.js"><link rel="prefetch" href="/assets/js/63.144d4911.js"><link rel="prefetch" href="/assets/js/64.c1f7ca69.js"><link rel="prefetch" href="/assets/js/65.6acc4663.js"><link rel="prefetch" href="/assets/js/66.4158c4fd.js"><link rel="prefetch" href="/assets/js/67.03478600.js"><link rel="prefetch" href="/assets/js/68.0857ca82.js"><link rel="prefetch" href="/assets/js/69.b08d89e8.js"><link rel="prefetch" href="/assets/js/7.bc07cd04.js"><link rel="prefetch" href="/assets/js/70.ceaebf06.js"><link rel="prefetch" href="/assets/js/71.a46405c3.js"><link rel="prefetch" href="/assets/js/72.da3edb4b.js"><link rel="prefetch" href="/assets/js/73.17982eab.js"><link rel="prefetch" href="/assets/js/74.9f2470a7.js"><link rel="prefetch" href="/assets/js/75.e89d6b57.js"><link rel="prefetch" href="/assets/js/76.6e19ae24.js"><link rel="prefetch" href="/assets/js/77.7a4ba6e7.js"><link rel="prefetch" href="/assets/js/78.8a8c5ae3.js"><link rel="prefetch" href="/assets/js/79.02e29ab1.js"><link rel="prefetch" href="/assets/js/8.63e0556e.js"><link rel="prefetch" href="/assets/js/80.49647de4.js"><link rel="prefetch" href="/assets/js/81.e8b8fc6a.js"><link rel="prefetch" href="/assets/js/82.3feccea9.js"><link rel="prefetch" href="/assets/js/83.a7a15b1c.js"><link rel="prefetch" href="/assets/js/84.18ea9ca3.js"><link rel="prefetch" href="/assets/js/85.bfd57520.js"><link rel="prefetch" href="/assets/js/86.4b0f2407.js"><link rel="prefetch" href="/assets/js/87.a9fea93d.js"><link rel="prefetch" href="/assets/js/88.2776cc33.js"><link rel="prefetch" href="/assets/js/89.3e80c4a5.js"><link rel="prefetch" href="/assets/js/9.9b1cfb35.js"><link rel="prefetch" href="/assets/js/90.5854f6b5.js"><link rel="prefetch" href="/assets/js/91.6e1f8245.js"><link rel="prefetch" href="/assets/js/92.dfd9f897.js"><link rel="prefetch" href="/assets/js/93.17caffba.js"><link rel="prefetch" href="/assets/js/94.8aba700d.js"><link rel="prefetch" href="/assets/js/95.4930ce57.js"><link rel="prefetch" href="/assets/js/96.76842511.js"><link rel="prefetch" href="/assets/js/97.8260ea8f.js"><link rel="prefetch" href="/assets/js/98.8efb1714.js"><link rel="prefetch" href="/assets/js/99.fd32bd85.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65ac630d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YupaiTS的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/format-usage.html" class="nav-link">String.format的用法</a></li><li class="dropdown-item"><!----> <a href="/java/collection-example.html" class="nav-link">Java集合杂谈</a></li><li class="dropdown-item"><!----> <a href="/java/instanceof.html" class="nav-link">Java运算符instanceof的用法</a></li><li class="dropdown-item"><!----> <a href="/java/enum-sample.html" class="nav-link">Java枚举类实例</a></li><li class="dropdown-item"><!----> <a href="/java/recursion.html" class="nav-link">Java递归的实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Golang</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/golang/gin-doc.html" class="nav-link">web框架Gin使用手册</a></li><li class="dropdown-item"><!----> <a href="/golang/gorm.html" class="nav-link">ORM框架gorm使用手册</a></li><li class="dropdown-item"><!----> <a href="/golang/go-spider.html" class="nav-link">爬虫框架go_spider</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列专题</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/java-base/base-syntax/" class="nav-link">Java基础知识</a></li><li class="dropdown-item"><!----> <a href="/topics/java-advanced/" class="nav-link">Java进阶知识</a></li><li class="dropdown-item"><!----> <a href="/topics/java-jvm/" class="nav-link">JVM虚拟机</a></li><li class="dropdown-item"><!----> <a href="/topics/spring-springboot-knowledge/" class="nav-link">Spring/Spring Boot讲解</a></li><li class="dropdown-item"><!----> <a href="/topics/springboot-samples.html" class="nav-link">Spring Boot示例</a></li><li class="dropdown-item"><!----> <a href="/topics/spring-cloud/" class="nav-link">基于Spring Cloud快速搭建微服务</a></li><li class="dropdown-item"><!----> <a href="/topics/docker/" class="nav-link">Docker入门攻略</a></li><li class="dropdown-item"><!----> <a href="/topics/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops-deploy/full-gc-troubleshoot.html" class="nav-link">Full GC排查流程</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/best-log-practice.html" class="nav-link">最佳日志实践</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/gitlab-ci-springboot.html" class="nav-link">GitLab-CI环境搭建与SpringBoot项目CI配置总结</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/gitee-jenkins-docker-ci-cd.html" class="nav-link">使用Gitee+Jenkins+Docker完成前后端分离项目的CI/CD</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/github-jenkins-ci-cd.html" class="nav-link">使用GitHub和Jenkins自动构建并部署静态页面</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/enable-swap.html" class="nav-link">通过开启swap分区解决小内存阿里云服务器的运行瓶颈</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/linux-command.html" class="nav-link">Linux常用指令</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/rabbitmq-deploy.html" class="nav-link">RabbitMQ安装部署及常见问题</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/aliyun-server-environment.html" class="nav-link">阿里云服务器环境搭建</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/aliyun-linux-disk-mount.html" class="nav-link">阿里云Linux服务器格式化和挂载数据盘</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实用工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vscode-plugins.html" class="nav-link">VS Code常用插件记录</a></li><li class="dropdown-item"><!----> <a href="/tools/linux-confluence.html" class="nav-link">Linux下安装Confluence</a></li><li class="dropdown-item"><!----> <a href="/tools/markdown-syntax.html" class="nav-link">Markdown语法</a></li><li class="dropdown-item"><!----> <a href="/tools/cron-syntax.html" class="nav-link">cron语法简单总结</a></li><li class="dropdown-item"><!----> <a href="/tools/hexo-blog.html" class="nav-link">使用hexo快速搭建个人博客</a></li><li class="dropdown-item"><!----> <a href="/tools/deploy-gitlab.html" class="nav-link">搭建 GitLab 私有代码托管</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实战总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/in-action/exception-solution.html" class="nav-link">常见异常解决方案总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/in-action-summary.html" class="nav-link router-link-exact-active router-link-active">开发实战总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/gitlab-manual.html" class="nav-link">GitLab使用手册</a></li><li class="dropdown-item"><!----> <a href="/in-action/springboot-vue-build.html" class="nav-link">SpringBoot和Vue单页面前后端分离项目的整合与构建</a></li><li class="dropdown-item"><!----> <a href="/in-action/git-branch-manage.html" class="nav-link">Git分支管理</a></li><li class="dropdown-item"><!----> <a href="/in-action/ultimate-spider-knowledge.html" class="nav-link">从Ultimate-Spider全方位解析数据采集系统的基本知识</a></li><li class="dropdown-item"><!----> <a href="/in-action/open-source-license.html" class="nav-link">开源项目License的介绍</a></li><li class="dropdown-item"><!----> <a href="/in-action/todo-tomato-knowledge.html" class="nav-link">Todo-Tomato技术解读</a></li><li class="dropdown-item"><!----> <a href="/in-action/wechat-admin.html" class="nav-link">微信公众号管理平台的实现</a></li><li class="dropdown-item"><!----> <a href="/in-action/weixin-java-tools.html" class="nav-link">weixin-java-tools微信JavaSDK开发工具包</a></li></ul></div></div><div class="nav-item"><a href="/books.html" class="nav-link">阅读书单</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div> <a href="https://github.com/YupaiTS" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/format-usage.html" class="nav-link">String.format的用法</a></li><li class="dropdown-item"><!----> <a href="/java/collection-example.html" class="nav-link">Java集合杂谈</a></li><li class="dropdown-item"><!----> <a href="/java/instanceof.html" class="nav-link">Java运算符instanceof的用法</a></li><li class="dropdown-item"><!----> <a href="/java/enum-sample.html" class="nav-link">Java枚举类实例</a></li><li class="dropdown-item"><!----> <a href="/java/recursion.html" class="nav-link">Java递归的实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Golang</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/golang/gin-doc.html" class="nav-link">web框架Gin使用手册</a></li><li class="dropdown-item"><!----> <a href="/golang/gorm.html" class="nav-link">ORM框架gorm使用手册</a></li><li class="dropdown-item"><!----> <a href="/golang/go-spider.html" class="nav-link">爬虫框架go_spider</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列专题</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/java-base/base-syntax/" class="nav-link">Java基础知识</a></li><li class="dropdown-item"><!----> <a href="/topics/java-advanced/" class="nav-link">Java进阶知识</a></li><li class="dropdown-item"><!----> <a href="/topics/java-jvm/" class="nav-link">JVM虚拟机</a></li><li class="dropdown-item"><!----> <a href="/topics/spring-springboot-knowledge/" class="nav-link">Spring/Spring Boot讲解</a></li><li class="dropdown-item"><!----> <a href="/topics/springboot-samples.html" class="nav-link">Spring Boot示例</a></li><li class="dropdown-item"><!----> <a href="/topics/spring-cloud/" class="nav-link">基于Spring Cloud快速搭建微服务</a></li><li class="dropdown-item"><!----> <a href="/topics/docker/" class="nav-link">Docker入门攻略</a></li><li class="dropdown-item"><!----> <a href="/topics/design-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ops-deploy/full-gc-troubleshoot.html" class="nav-link">Full GC排查流程</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/best-log-practice.html" class="nav-link">最佳日志实践</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/gitlab-ci-springboot.html" class="nav-link">GitLab-CI环境搭建与SpringBoot项目CI配置总结</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/gitee-jenkins-docker-ci-cd.html" class="nav-link">使用Gitee+Jenkins+Docker完成前后端分离项目的CI/CD</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/github-jenkins-ci-cd.html" class="nav-link">使用GitHub和Jenkins自动构建并部署静态页面</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/enable-swap.html" class="nav-link">通过开启swap分区解决小内存阿里云服务器的运行瓶颈</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/linux-command.html" class="nav-link">Linux常用指令</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/rabbitmq-deploy.html" class="nav-link">RabbitMQ安装部署及常见问题</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/aliyun-server-environment.html" class="nav-link">阿里云服务器环境搭建</a></li><li class="dropdown-item"><!----> <a href="/ops-deploy/aliyun-linux-disk-mount.html" class="nav-link">阿里云Linux服务器格式化和挂载数据盘</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实用工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vscode-plugins.html" class="nav-link">VS Code常用插件记录</a></li><li class="dropdown-item"><!----> <a href="/tools/linux-confluence.html" class="nav-link">Linux下安装Confluence</a></li><li class="dropdown-item"><!----> <a href="/tools/markdown-syntax.html" class="nav-link">Markdown语法</a></li><li class="dropdown-item"><!----> <a href="/tools/cron-syntax.html" class="nav-link">cron语法简单总结</a></li><li class="dropdown-item"><!----> <a href="/tools/hexo-blog.html" class="nav-link">使用hexo快速搭建个人博客</a></li><li class="dropdown-item"><!----> <a href="/tools/deploy-gitlab.html" class="nav-link">搭建 GitLab 私有代码托管</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">实战总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/in-action/exception-solution.html" class="nav-link">常见异常解决方案总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/in-action-summary.html" class="nav-link router-link-exact-active router-link-active">开发实战总结</a></li><li class="dropdown-item"><!----> <a href="/in-action/gitlab-manual.html" class="nav-link">GitLab使用手册</a></li><li class="dropdown-item"><!----> <a href="/in-action/springboot-vue-build.html" class="nav-link">SpringBoot和Vue单页面前后端分离项目的整合与构建</a></li><li class="dropdown-item"><!----> <a href="/in-action/git-branch-manage.html" class="nav-link">Git分支管理</a></li><li class="dropdown-item"><!----> <a href="/in-action/ultimate-spider-knowledge.html" class="nav-link">从Ultimate-Spider全方位解析数据采集系统的基本知识</a></li><li class="dropdown-item"><!----> <a href="/in-action/open-source-license.html" class="nav-link">开源项目License的介绍</a></li><li class="dropdown-item"><!----> <a href="/in-action/todo-tomato-knowledge.html" class="nav-link">Todo-Tomato技术解读</a></li><li class="dropdown-item"><!----> <a href="/in-action/wechat-admin.html" class="nav-link">微信公众号管理平台的实现</a></li><li class="dropdown-item"><!----> <a href="/in-action/weixin-java-tools.html" class="nav-link">weixin-java-tools微信JavaSDK开发工具包</a></li></ul></div></div><div class="nav-item"><a href="/books.html" class="nav-link">阅读书单</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于我</a></div> <a href="https://github.com/YupaiTS" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>开发实战总结</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/in-action/in-action-summary.html#java" class="sidebar-link">Java</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#springboot" class="sidebar-link">SpringBoot</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#bootstrap" class="sidebar-link">Bootstrap</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#jquery" class="sidebar-link">JQuery</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#css" class="sidebar-link">CSS</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#html" class="sidebar-link">HTML</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#vue-js" class="sidebar-link">Vue.js</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#缓存" class="sidebar-link">缓存</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#构建" class="sidebar-link">构建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#部署" class="sidebar-link">部署</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#windows" class="sidebar-link">Windows</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#linux" class="sidebar-link">Linux</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/in-action/in-action-summary.html#docker" class="sidebar-link">Docker</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="开发实战总结"><a href="#开发实战总结" aria-hidden="true" class="header-anchor">#</a> 开发实战总结</h1> <p>总结了一些实际开发过程中需要注意的一些细节。（持续更新...）</p> <h2 id="java"><a href="#java" aria-hidden="true" class="header-anchor">#</a> Java</h2> <ol><li><p><code>RandomUtils.nextInt()</code> 生成随机整数，<code>RandomStringUtils</code> 生成随机字符串。</p></li> <li><p>实现随机抽取集合里面的部分元素 <code>Collections.shuffle(list)</code> 将 list 元素循序打乱 <code>list.subList(0, loreResource.getQuesNum()); // subList(fromIndex, toIndex)的实际范围是[fromIndex, toIndex)</code> 获取指定数量的元素。</p></li> <li><p><code>ListUtils.select()</code> 方法，类似于 JQuery 数组的 filter 方法。</p></li> <li><p><code>System.out.println(Arrays.toString(someList.toArray()));</code> 方法可以方便地打印List内容。</p></li> <li><p><code>Arrays.asList(T... a)</code> 无法将基本类型转换为 List，原因是 <code>asList()</code> 方法接收的是泛型的可变长参数，而基本类型（如int，char等）是无法泛型化的。使用 <code>asList()</code> 对基本数据类型进行操作时需要使用基本数据类型的包装类。<code>asList()</code> 返回的 ArrayList 类型是 <code>Arrays</code> 的一个内部类，没有实现 <code>add()</code> 、 <code>remove()</code> 等用于操作 ArrayList 的方法，当我们需要对 <code>asList()</code> 返回的列表进行常用操作时需要对其进行转换，<code>List list = new ArrayList(Arrays.asList(testArray));</code></p></li> <li><p>Java类启动顺序，<code>static</code> 静态代码先于构造方法。</p></li></ol> <h2 id="springboot"><a href="#springboot" aria-hidden="true" class="header-anchor">#</a> SpringBoot</h2> <ol><li><p>如果项目启用了事务管理，Service 的实现类在增删改数据时需要加上 <code>@Transactional</code> 注解标明该类或方法加入了事务管理。</p></li> <li><p>使用 shiro 权限框架时，需要检查需要权限控制的 Controller 类或方法是否加上了 <code>@RequiresRoles</code> 或 <code>@RequiresPermissions</code> 注解。</p></li> <li><p>Controller 的方法传入 <code>@RequestBody</code> 参数时，method 只能是 POST 或 PUT。</p></li> <li><p>Controller 通过 Model 对象实例通过 setAttribute 方法传值到前端 jsp 页面或是其他模板页面时，如果是在 js 里获取的话需要通过 var param = '${param}' 方式获取，用''引起来可以避免当 ${param} 为空时 js 代码报错的问题，但同时也将参数类型强制转换为 string 类型了；当参数类型是 List 集合时，需要使用 eval('${param}') 方法。</p></li> <li><p>后台在增删改数据时，记得更新和该数据相关的缓存；特别是在更改记录时要更新更改之前和之后会包含该记录的缓存。</p></li> <li><p>跨域访问时，可以在全局 Interceptor 中使用 <code>httpServletResponse.setHeader(&quot;Access-Control-Allow-Origin&quot;, ACCESS_CONTROL_ALLOW_ORIGIN)</code> 限制可跨域访问的域名，类似的，使用 <code>httpServletResponse.setHeader(&quot;Access-Control-Allow-Methods&quot;, ACCESS_CONTROL_ALLOW_METHODS)</code> 限制请求方法，<code>httpServletResponse.setHeader(&quot;Access-Control-Max-Age&quot;, ACCESS_CONTROL_MAX_AGE)</code> 设置可跨域访问的时限， <code>httpServletResponse.setHeader(&quot;Access-Control-Allow-Headers&quot;, ACCESS_CONTROL_ALLOW_HEADERS)</code> 限制请求头参数。</p></li> <li><p>SpringBoot 中可以使用 <code>@EnableScheduling</code> 注解启用定时任务功能，在方法上使用 <code>@Scheduled</code> 注解设置任务启动的时间。</p></li> <li><p>访问日志功能的实现：定义一个 LogInterceptor ，使用 <code>logger.info()</code> 等方法记录下 httpServletRequest 中相关属性。</p></li> <li><p>shiro 的 reaml 中保存的 Principal 为 User 对象时，页面上想要获取 User 对象的 username 属性可以使用 <code>&lt;shiro:principal property=&quot;username&quot;/&gt;</code> 标签，注意这里的 property 即是对应的属性名。</p></li> <li><p>Spring 框架自带的 <code>BeanUtils.copyProperties(Object source, Object target, String... ignoreProperties)</code> 方法可以方便的做类属性的拷贝。</p></li> <li><p>SpringBoot security 在使用 <code>.antMatchers(&quot;/management/**&quot;).hasAnyRole(&quot;SuperAdmin&quot;, &quot;admin&quot;)</code> 要注意数据库里保存的角色名称必须要以 <code>'ROLE_'</code> 开头，这里的角色在数据库的名称应为 <code>&quot;ROLE_SuperAdmin&quot;</code> 和 <code>&quot;ROLE_admin&quot;</code>。</p></li> <li><p>SpringBoot security 的注解 <code>@PreAuthorize</code> 可以用在类或方法上来进行权限控制，其中 <code>hasRole()</code> 和 <code>hasAuthority()</code> 的区别在于前者可以忽略角色信息的前缀（默认是 &quot;ROLE_&quot;），而后者则必须要包含前缀。例如当保存的角色信息为&quot;ROLE_admin&quot;时， <code>hasRole('admin')</code> 和 <code>hasAuthority('ROLE_admin')</code> 是等效的。</p></li> <li><p>SpringBoot 在整合 shiro 时无法在使用 rememberMeCookie 实现&quot;记住我&quot;（即 rememberMe）功能的同时实现使用 sessionIdCookie 单独管理用户 session 信息。而使用 sessionIdCookie 可以解决出现404之后刷新页面直接跳转到登录页面的问题（问题详情：<a href="http://jinnianshilongnian.iteye.com/blog/1999182" target="_blank" rel="noopener noreferrer">http://jinnianshilongnian.iteye.com/blog/1999182<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p></li> <li><p>SpringBoot JPA 可以很简单的集成分页和排序功能，支持的 request 参数如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>page，第几页，从 0 开始，默认为第 0 页；  
size，每一页的数量，默认为 10；  
sort，排序相关的信息，以 `property,direction(,ASC|DESC)` 的方式组织，例如 `sort=firstname&amp;sort=lastname,desc` 表示在按 firstname 增序排列的基础上按 lastname 的降序排列。  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>例如请求链接为：
<code>http://host:port/blogs?page=0&amp;size=3&amp;sort=category,asc&amp;sort=description,desc</code></p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> Page<span class="token generics function"><span class="token punctuation">&lt;</span>Blog<span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PageableDefault</span><span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sort <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> direction <span class="token operator">=</span> Sort<span class="token punctuation">.</span>Direction<span class="token punctuation">.</span>DESC<span class="token punctuation">)</span> Pageable pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> startTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Page<span class="token generics function"><span class="token punctuation">&lt;</span>Blog<span class="token punctuation">&gt;</span></span> blogPage <span class="token operator">=</span> <span class="token punctuation">(</span>Page<span class="token generics function"><span class="token punctuation">&lt;</span>Blog<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>blogCachePrefix <span class="token operator">+</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>blogPage <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        blogPage <span class="token operator">=</span> blogRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>blogCachePrefix <span class="token operator">+</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">,</span> blogPage<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> endTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;获取分页博客博客，pageable ：{}, 耗时：{}ms&quot;</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> blogPage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>使用 jackson 将实体对象转成 JSON ，在属性上加上 @JsonInclude(JsonInclude.Include.NON_NULL) 注解，当该属性NULL或者为空时将不参加序列化。JsonInclude 可选项有：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>JsonInclude.Include.ALWAYS      //默认总是参加序列化
JsonInclude.Include.NON_DEFAULT //属性为默认值不序列化
JsonInclude.Include.NON_EMPTY   //属性为空或NULL都不序列化
JsonInclude.Include.NON_NULL    //属性为NULL不序列化
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>实体类里的<strong>Enum</strong>类型的属性映射数据库字段的时候可以使用 <code>@Convert(converter = Status.class, attributeName = &quot;status&quot;)</code> 注解；jackson 在序列化<strong>Enum</strong>类型的时候可以在<strong>Enum</strong>类对应的<strong>getter</strong>方法使用 <code>@JsonValue</code> 注解来定义向前端输出的内容，而前端传过来的值同样可以通过 <code>@JsonCreator</code> 注解反序列化得到对应的<strong>Enum</strong>类型对象。</p></li> <li><p><em>1.5.6.RELEASE</em> 版本的<strong>SpringBoot</strong>在使用 <code>ElasticsearchRespository</code> 类时会产生以下异常：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException:                 Could not write JSON document: (was java.lang.NullPointerException) (through reference chain: org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl[&quot;facets&quot;]); nested exception is com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain:     org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl[&quot;facets&quot;])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>推荐使用 <em>1.4.7.RELEASE</em> 版本。</p></li> <li><p>Json 序列化的时候会将 Long 等类型强转成类似于 Javascript 中的 number 类型（内部实现<strong>可能</strong>是转成 Double 类型），这样会导致大数值丢失精度的问题。jackson 可以使用 <code>@JsonSerialize(using = ToStringSerializer.class)</code> 注解将 Long 类型转成String 再进行序列化，但这样会导致前端接收到的数据类型变成了 String 而不是 number。</p></li> <li><p>在进行批量更新操作时，需要将待更新的数据进行排序之后再进行批量操作，这样可以避免并发场景下的死锁问题。</p></li> <li><p>@RequestBody注解的实体对象如果需要将前端传过来的 array 转成实体中相应的 String 类型的属性时，可以在该属性的 setter 方法进行转换操作。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;welcome_message&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WelcomeMessage</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;articles&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String articles<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArticles</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>WxMpXmlOutNewsMessage<span class="token punctuation">.</span>Item<span class="token punctuation">&gt;</span></span> articles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>articles <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>WxMpXmlOutNewsMessage<span class="token punctuation">.</span>Item<span class="token punctuation">&gt;</span></span> <span class="token function">getArticles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>articles<span class="token punctuation">,</span> WxMpXmlOutNewsMessage<span class="token punctuation">.</span>Item<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>相应的，如果需要将数据库中存储的 String 转成 List 传回前端或者应用于后台逻辑，可以在字段对应属性的 getter 方法进行转换。
这里使用的是 fastjson 的 JSON 类。</p></li> <li><p>过长的 Long 类型主键转 Json 传回前端会使用js处理会丢失精度，可以在实体的 @Id 上配置转成 Json 的序列化及反序列化处理类，在将 id 传回前端或者接收 前端传过来的 id 时使用 String 类型来进行转换保证精度，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* 解决Long类型的主键转json传回前端丢失精度的问题，将Long转成String
* @author yupaits
* @date 2017/12/18
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongJsonSerializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonSerializer</span><span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span>Long value<span class="token punctuation">,</span> JsonGenerator jsonGenerator<span class="token punctuation">,</span> SerializerProvider serializerProvider<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> JsonProcessingException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jsonGenerator<span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* 将前端String类型的主键转成Long类型
* @author yupaits
* @date 2017/12/18
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongJsonDeserializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonDeserializer</span><span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Long <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonParser jsonParser<span class="token punctuation">,</span> DeserializationContext deserializationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> JsonProcessingException <span class="token punctuation">{</span>
        String value <span class="token operator">=</span> jsonParser<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> Long<span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Id</span>
<span class="token annotation punctuation">@JsonSerialize</span><span class="token punctuation">(</span>using <span class="token operator">=</span> LongJsonSerializer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JsonDeserialize</span><span class="token punctuation">(</span>using <span class="token operator">=</span> LongJsonDeserializer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>SpringAop的Order顺序遵循先进后出的原则。如Aop1（order=1），Aop2（order=2），则切面的执行顺序为<code>Aop1.doAround.beforeProceed</code> -&gt;  <code>Aop1.doBefore</code> -&gt; <code>Aop2.doAround.beforeProcced</code> -&gt; <code>Aop2.doBefore</code> -&gt; <code>Aop2.doAround.afterProcced</code> -&gt; <code>Aop2.doAfter</code> -&gt; <code>Aop2.doAfterReturning</code> -&gt; <code>Aop1.doAround.afterProcced</code> -&gt; <code>Aop1.doAfter</code> -&gt; <code>Aop1.doAfterReturning</code>。</p></li> <li><p>Spring Boot启动时指定环境。</p> <ul><li>IDEA中进入 <code>Run/Debug Configurations</code> 设置 <code>Environment-&gt;VM options</code> 为 <code>-Dspring.profiles.active=test</code>，或者在 <code>Environment variables</code> 中添加参数 <code>spring.profiles.active</code> 并指定参数的值为 <code>test</code>。</li> <li>命令行使用 <code>java -jar *.jar</code> 启动时，在命令的后面增加 <code>--spring.profiles.active=test</code>。</li> <li>在 <code>application.yml</code> 中配置 <code>spring.profiles.active</code> 的值为 <code>test</code>。</li></ul></li> <li><p>通过zuul上传包含中文名的文件时，需要在上传文件url的path加上 <code>/zuul</code> 前缀即可。</p> <p>例如：当上传url为 <code>http://localhost:10060/upload/image</code>，上传名为 <code>头像.jpg</code> 的文件，会出现报错 <code>java.io.FileNotFoundException: E:\upload\image\2018-5\??.jpg (文件名、目录名或卷标语法不正确。)</code>。如果将url直接改为<code>http://localhost:10060/zuul/upload/image</code> 则可以上传成功。</p></li> <li><p>Spring Boot Jpa实现实体联合主键：实体类加上 <code>@IdClass(XxxKey.class)</code> 注解，实体类中多个联合注解的属性上都加上 <code>@Id</code> 注解。示例：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@IdClass</span><span class="token punctuation">(</span>UserRoleKey<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;shop_user_role&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRole</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long userId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long roleId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRoleKey</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Long userId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Long roleId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>使用Spring Cloud Sleuth的日志中会包含链路追踪的信息，具体体现为:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2017-04-08 23:56:50.459 INFO [bootstrap,38d6049ff0686023,d1b8b0352d3f6fa9,false] 8764 — [nio-8080-exec-1] demo.JpaSingleDatasourceApplication : Step 2: Handling print
2017-04-08 23:56:50.459 INFO [bootstrap,38d6049ff0686023,d1b8b0352d3f6fa9,false] 8764 — [nio-8080-exec-1] demo.JpaSingleDatasourceApplication : Step 1: Handling home
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>比一般的日志多出了 <code>[bootstrap,38d6049ff0686023,d1b8b0352d3f6fa9,false]</code> 这些内容，对应 <code>[appname,traceId,spanId,exportable]</code>。</p> <ul><li>appname：服务名称</li> <li>traceId\spanId：链路追踪的两个术语</li> <li>exportable: 是否是发送给zipkin</li></ul></li> <li><p>SpringBoot中使用 <code>logback-spring.xml</code> 进行日志打印的配置。示例：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>30 seconds<span class="token punctuation">&quot;</span></span> <span class="token attr-name">debug</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>appName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logPattern<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} - [${appName}] - ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- [%t] %c - %m%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amqp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.amqp.rabbit.logback.AmqpAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span>172.17.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>host</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>5672<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span>guest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>guest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>applicationId</span><span class="token punctuation">&gt;</span></span>okbuy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>applicationId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>routingKeyPattern</span><span class="token punctuation">&gt;</span></span>logstash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>routingKeyPattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declareExchange</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declareExchange</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exchangeType</span><span class="token punctuation">&gt;</span></span>direct<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exchangeType</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exchangeName</span><span class="token punctuation">&gt;</span></span>okbuy.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exchangeName</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generateId</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generateId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxSenderRetries</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxSenderRetries</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>durable</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>durable</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deliveryMode</span><span class="token punctuation">&gt;</span></span>PERSISTENT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>deliveryMode</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${logPattern}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stdoutAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${logPattern}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>utf8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>asyncStdoutAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.classic.AsyncAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discardingThreshold</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queueSize</span><span class="token punctuation">&gt;</span></span>1024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queueSize</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stdoutAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeCallerData</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeCallerData</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WARN<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amqp<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>asyncStdoutAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></li> <li><p>Spring的事务控制和数据库的事务控制之间的关系：</p> <ul><li>数据库开启事务、提交事务、回滚事务对应jdbc的三个api，Spring事务控制的本质是通过AOP把这三个方法增强在不同的地方调用，实现Spring的事务在方法之间的传播。</li> <li>数据库在开启事务到提交的过程中，数据库本身有异常都会回滚。</li> <li>业务异常导致数据库回滚，是Spring通过调用 <code>jdbc rollback</code> 的api实现的。</li></ul></li> <li><p>Spring Security OAuth2 Client项目中@EnableOAuth2Sso注解修饰Application启动类时不起作用，需要放在@Configuration修饰的类上（通常是继承WebSecurityConfigurerAdapter的配置类）才能正常工作。</p></li> <li><p>检查幂等（是否重复请求）伪代码：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tb_unique<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>request_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'request id'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span> <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span> <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'修改时间'</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>request_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'幂等表'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-Java line-numbers-mode"><pre class="language-java"><code>bool <span class="token function">checkUnique</span><span class="token punctuation">(</span>String requestId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        UniqueDO uniqueDO <span class="token operator">=</span> <span class="token function">buildUniqueDO</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//reqeustId唯一索引，重复则抛异常DataIntegrityViolationException</span>
        uniqueDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>uniqueDO<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//插入成功说明之前没有数据，返回没有被幂等</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataIntegrityViolationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//出现异常不一定时由于db里面有数据，可能是事务隔离级别导致，</span>
        <span class="token comment">//所以要再查一次，确认数据再db里面存在</span>
        UniqueDO uniqueDO <span class="token operator">=</span> uniqueDao<span class="token punctuation">.</span><span class="token function">selectByRequestId</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueDO <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//不存在数据则抛异常让方法重试</span>
            <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//存在返回被幂等</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>requestId一般由客户端sdk生成和具体业务相关联。</p></li></ol> <h2 id="bootstrap"><a href="#bootstrap" aria-hidden="true" class="header-anchor">#</a> Bootstrap</h2> <ol><li>页面的modal元素记得加上 <code>data-backdrop='static'</code> 和 <code>data-keyboard='false'</code>，禁用非 modal 内点击和点击键盘 ESC 键 取消 modal。</li></ol> <h2 id="jquery"><a href="#jquery" aria-hidden="true" class="header-anchor">#</a> JQuery</h2> <ol><li><p>批量删除并返回批量删除的结果时，ajax 方法中 async 一定要配置成 false，否则页面无法正确响应批量删除的结果。</p></li> <li><p>使用 qrcodejs 生成二维码图片之后直接使用 <code>$('img').attr('src')</code> 返回的值是undefined，这时需要使用 <code>setTimeout(function(), delay_time)</code> 来拿到图片的 src 。</p></li> <li><p>js数组遍历删除元素的方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h2 id="css"><a href="#css" aria-hidden="true" class="header-anchor">#</a> CSS</h2> <ol><li><p>局部列表滚动查看css，height和max-height二选一。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.grid-list</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 190px<span class="token punctuation">;</span> //固定高度的列表
    <span class="token property">max-height</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span> //列表最大高度
    <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.grid-list::-webkit-scrollbar</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <h2 id="html"><a href="#html" aria-hidden="true" class="header-anchor">#</a> HTML</h2> <ol><li>使用原生HTML进行表单开发时，如果没有指定 <code>&lt;button&gt;</code> 的 <code>type</code> 属性，则默认 <code>type=&quot;submit&quot;</code>，最终导致点击之后 <code>window.location.href</code> 的路径中会自动多一个 <code>?</code>，这是因为原生的表单提交是以path后拼接form的参数进行请求的，所以在进行异步请求时需要指定提交的按钮为 <code>&lt;button type=&quot;button&quot;&gt;</code>。</li></ol> <h2 id="vue-js"><a href="#vue-js" aria-hidden="true" class="header-anchor">#</a> Vue.js</h2> <ol><li><p>使用局部的 filter 代替 methods 中的方法格式化数据显示。</p></li> <li><p>vue 在绑定 date 类型的 input 输入框时，设置默认值要用 <code>:value=&quot;date | toDate&quot;</code>，toDate 为过滤器；当 date 的值是 timestamp 类型时，toDate 可以为以下方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dateTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> hour <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> minute <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> second <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> 
            <span class="token punctuation">(</span>month <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> month <span class="token punctuation">:</span> month<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> 
            <span class="token punctuation">(</span>day <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> day <span class="token punctuation">:</span> day<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> 
            <span class="token punctuation">(</span>hour <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> hour <span class="token punctuation">:</span> hour<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> 
            <span class="token punctuation">(</span>minute <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> minute <span class="token punctuation">:</span> minute<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> 
            <span class="token punctuation">(</span>second <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> second <span class="token punctuation">:</span> second<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> date<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>vue.js 2.5.2版本在 v-for 循环中使用 v-model 绑定数组元素时会报如下错误：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>You are binding v-model directly to a v-for iteration alias. This will not be able to modify the v-for source array because writing to the alias is like modifying a function local variable. Consider using an array of objects and use v-model on an object property instead.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从提示信息可以看出 vue 建议使用 array 的某个元素的属性值作为 v-model 绑定的主体，如果元素并不是 Object 类型而是 String 类型时，需要通过 index 来实现元素绑定。具体代码如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(el, index)  in array<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>array[index]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>将数组中位于 index1 的元素移动至 index2 的位置：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>交换数组中位于 index1 和 index2 的两个元素：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>list<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>vue 组件中实时交换位于 index1 和 index2 的两个元素：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> index1<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Vue的 <code>filters</code> 块中的过滤器不能加载自身 <code>data()</code> 块中的变量，如果需要使用 <code>data()</code> 中的变量对数据进行转换时可以将过滤器的逻辑写在 <code>methods</code> 块中。</p></li></ol> <h2 id="缓存"><a href="#缓存" aria-hidden="true" class="header-anchor">#</a> 缓存</h2> <ol><li>使用 redis-cli 进入 redis 的命令行模式时，可以使用 <code>keys **</code> 查看所有 key 值，使用 <code>get [key]</code> 查看 key 对应的 value 值。需要注意的是，使用 <code>keys **</code> 查看到的 key 值如果使用 &quot;&quot; 包括，那么 <code>get [key]</code> 的 key 也需要用 &quot;&quot; 包括起来。</li></ol> <h2 id="构建"><a href="#构建" aria-hidden="true" class="header-anchor">#</a> 构建</h2> <ol><li><p>使用 <strong><code>frontend-maven-plugin</code></strong> 整合前后端项目构建时，需要注意web模块需要放在server模块之前，保证web先构建，这样才能将web构建好的文件复制到server的 <code>resources/public</code> 目录下。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>xxx-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>xxx-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>同时要注意后台不要对 <code>@RequestMapping(&quot;/&quot;)</code> 做处理，否则有可能会使得访问 <code>&quot;/&quot;</code> 无法显示前端构建好的index.html页面。</p></li> <li><p>maven引用私服的jar包时，需要在 <code>pom.xml</code> 文件的 <code>&lt;repositories&gt;</code> 标签下中指定私服的 <code>&lt;id&gt;</code>、<code>&lt;name&gt;</code>、<code>&lt;url&gt;</code>。</p></li> <li><p>gitlab-runner的 <code>config.toml</code> 在 <code>[runners.docker]</code>中配置 <code>extra_hosts = [&quot;xxx.xxx.com:172.17.0.1&quot;]</code>可实现runner容器的ip和host映射关系的配置。</p></li></ol> <h2 id="部署"><a href="#部署" aria-hidden="true" class="header-anchor">#</a> 部署</h2> <ol><li><p>windows 下使用 Nginx 相关命令如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#启动
点击 Nginx 目录下的 nginx.exe；cmd 运行 start nginx

#关闭
nginx -s stop #立即停止nginx，不保存相关信息
nginx -s quit #正常退出nginx，并保存相关信息

#重启（重新加载配置）
nginx -s reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>nginx 的配置文件 root 路径不识别 <code>\</code> 只识别 <code>/</code>。</p></li> <li><p>Letsencrypt通配符证书的申请和在nginx配置：</p> <ul><li><a href="https://my.oschina.net/kimver/blog/1634575" target="_blank" rel="noopener noreferrer">申请Let's Encrypt通配符HTTPS证书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cyberciti.biz/faq/how-to-configure-nginx-with-free-lets-encrypt-ssl-certificate-on-debian-or-ubuntu-linux/" target="_blank" rel="noopener noreferrer">How to configure Nginx with Let’s Encrypt on Debian/Ubuntu Linux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>使用 nginx 解决 CORS 问题</p> <p>使用反向代理将服务端（接口提供方）与客户端（接口调用方）部署在同一个域下。</p></li> <li><p>使用 nginx 解决 X-Frame-Options: deny 问题</p> <p>使用<a href="https://github.com/openresty/headers-more-nginx-module" target="_blank" rel="noopener noreferrer">headers-more<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件，推荐直接下载带headers-more模块的openresty，<a href="https://openresty.org/en/download.html" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>在 nginx.conf 中（一般是在server下）配置：</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code># 删除 &quot;X-Frame-Options&quot; header
more_clear_headers 'X-Frame-Options';
# 设置 &quot;X-Frame-Options: SAMEORIGIN&quot; 同域可嵌入iframe
more_set_headers 'X-Frame-Options: SAMEORIGIN';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>指定MySQL时区，在mysqld.conf中增加 <code>default-time-zone='+8:00'</code> 配置。</p></li> <li><p>在做微信公众号开发时，需要在公网上调用开发机器的接口，除了使用花生壳等软件进行内网穿透之外，如果有富余的公网服务器资源，可以使用一些简单方便的内网穿透工具，推荐 <a href="https://github.com/sosont/ichWebpass" target="_blank" rel="noopener noreferrer">ichWebpass<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li></ol> <h2 id="windows"><a href="#windows" aria-hidden="true" class="header-anchor">#</a> Windows</h2> <ol><li><p>为了在windows系统上安装docker，需要将win10系统升级到专业版开启HyperV虚拟机才行。</p> <p>win10专业版升级密钥：DR9VN-GF3CR-RCWT2-H7TR8-82QGT</p></li></ol> <h2 id="linux"><a href="#linux" aria-hidden="true" class="header-anchor">#</a> Linux</h2> <ol><li><p>Ubuntu/Debian开机启动脚本 <code>spider.sh</code> 示例：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">### BEGIN INIT INFO</span>
<span class="token comment"># Provides: spider</span>
<span class="token comment"># Required-Start:</span>
<span class="token comment"># Required-Stop:</span>
<span class="token comment"># Default-Start: 2 3 4 5</span>
<span class="token comment"># Default-Stop: 0 1 6</span>
<span class="token comment"># Short-Description: spider</span>
<span class="token comment"># Description: spider service start</span>
<span class="token comment">### END INIT INFO</span>

<span class="token punctuation">[</span>shell content<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>开机启动：<code>update-rc.d spider.sh defaults</code></li> <li>移除开机启动：<code>update-rc.d spider.sh remove</code></li></ul></li> <li><p>使用netstat查看系统网络端口情况：<code>netstat -tunlp</code>；如果发现没有 <code>PID</code> (进程号)，需要使用 <code>sudo netstat -tunlp</code>。</p></li> <li><p>对于新安装的官方Ubuntu-server等系统，可以通过指令 <code>sudo apt-get install build-essential</code> 安装gcc环境。</p></li> <li><p>取消sudo密码：<code>sudo visudo</code> 进入编辑界面；添加行 <code>username ALL=(ALL) NOPASSWD:ALL</code>，username为登录用户名，如果想作用于某个用户组则使用 <code>%usergroup ALL=(ALL:ALL) NOPASSWD:ALL</code>。</p></li></ol> <h2 id="docker"><a href="#docker" aria-hidden="true" class="header-anchor">#</a> Docker</h2> <ol><li><p>使用docker-compose的build参数构建docker镜像时，要注意指定的context目录下默认的Dockerfile文件名必须为 <code>Dockerfile</code>。如果想使用其他文件名，可以通过 <code>-f filename</code> 指定。</p></li> <li><p>docker环境为docker for windows，有效避免host为windows系统时 <code>docker run -v</code> 绑定的目录映射关系在系统重启之后失效的方法为：使用 <code>docker volume create path1</code> 创建volume，再使用 <code>-v path1:/container/path</code>。简单地说就是使用 “自定义数据卷” 代替 “容器自动创建的临时数据卷” 进行映射，完成docker容器的数据持久化。</p></li> <li><p>指定docker的dns，防止网络环境变化时导致容器网络的不稳定。
编辑docker的<code>daemon.json</code>:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;dns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>使用docker-compose来部署redash时，注意需要先创建redash数据库才能启动：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> docker-compose run --rm server create_db
<span class="token function">sudo</span> docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>使用docker方式部署consul时，由于consul在docker虚拟网络中无法正确识别注册服务的hostname，因此需要在注册服务中配置 spring.cloud.consul.discovery.hostname=192.168.1.xxx (注册服务的局域网ip，要注意的是必须是docker宿主机所在地局域网ip，使用172.17.0.1等docker内网ip也不行)，才能确保consul正确地进行健康检查。</p></li></ol></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/YupaiTS/blog/edit/master/post/in-action/in-action-summary.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2019-3-8 08:35:20</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.714fd557.js" defer></script><script src="/assets/js/12.18f8ea25.js" defer></script>
  </body>
</html>
