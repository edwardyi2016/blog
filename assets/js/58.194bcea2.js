(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{287:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/sF1xZY9ZrLVOXvTD4jiHRA",target:"_blank",rel:"noopener noreferrer"}},[t._v("并发编程 ：Concurrent 用户指南 ( 上 )"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/BrI7y7gKaBTDdtLm15ezzw",target:"_blank",rel:"noopener noreferrer"}},[t._v("并发编程 ：Concurrent 用户指南 ( 中 )"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/XxTazsHStb7BwjUxKflpdA",target:"_blank",rel:"noopener noreferrer"}},[t._v("并发编程 ：Concurrent 用户指南 ( 下 )"),a("OutboundLink")],1)])]),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("是线程安全的。")]),t._v(" "),a("p",[t._v("put方法，首先是对key.hashCode进行hash操作，得到hash值。然后获取对应的segment对象，接着调用Segment对象的put方法完成当前操作。当调用put方法时，首先lock操作。完成操作后再释放锁。")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://ifeve.com/concurrenthashmap/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://ifeve.com/concurrenthashmap/"),a("OutboundLink")],1)]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("可以控制某资源同时被访问的个数。例如连接池中通常要控制创建连接的个数。")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("闭锁，确保一个服务不会开始，直到它依赖的其他服务都已经开始，它允许一个或多个线程，等待一个事件集的发生。通过减计数的方式，控制多个线程同时开始某个动作。当计数为0时，await后的代码才会被执行。提供await()和countDown()两个方法。")]),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("CyclicBarrier中的await方法会对count值减1，并阻塞当前线程（java.util.concurrent.locks.Condition.await()），如果 count == 0 先执行CyclicBarrier内部的Runnable任务（java.lang.Runnable.run()），然后唤醒所有阻塞的线程（java.util.concurrent.locks.Condition.signalAll()），count恢复初始值（可以进入下一轮循环）。")]),t._v(" "),a("p",[t._v("与CountdownLatch不同的是，它可以循环重用。")]),t._v(" "),t._m(8),a("p",[t._v("结果：")]),t._v(" "),t._m(9),t._m(10),t._v(" "),a("p",[t._v("原子操作，线程安全。之前如果多线程累计计数，需要通过锁控制。IncrementAndGet方法，关键是调用了compareAndSwap方法，是native方法，基于cpu的CAS原语来实现的。简单原理是由cpu比较内存位置上的值是否为当前值，如果是换成新值，否则返回false。")]),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("提供线程池服务，ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue workQueue, RejectedExecutionHandler handler)")]),t._v(" "),a("p",[t._v("参数说明：")]),t._v(" "),t._m(12),a("p",[t._v("block queue由以下几种实现:")]),t._v(" "),t._m(13),t._v(" "),a("p",[t._v("RejectExecutionHanlder是针对任务无法处理时的一些自我保护处理：")]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("确定线程数首先需要考虑到系统可用的处理器核心数：")]),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("如果所有的任务都是计算密集型的，则创建处理器可用核心数这么多个线程就可以了，这样就可以充分利用处理器，也就是让它以最大火力不停进行计算。创建更多的线程对于程序性能反而是不利的，因为多个线程间频繁进行上下文切换对于程序性能损耗较大。")]),t._v(" "),a("p",[t._v("如果任务都是IO密集型的，那我们就需要创建比处理器核心数大几倍数量的线程。为何？当一个任务执行IO操作时，线程将被阻塞，于是服务器可以立即进行上下文切换以便处理其他就绪线程。如果我们只有处理器核心数那么多个线程的话，即使有待执行的任务也无法调度处理了。")]),t._v(" "),a("p",[t._v("因此，线程数与我们每个任务处于阻塞状态的时间比例相关。假如任务有50%时间处于阻塞状态，那程序所需线程数时处理器核心数的两倍。我们可以计算出程序所需的线程数，公式如下：")]),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("其中阻塞系数在0到1范围内。")]),t._v(" "),a("p",[t._v("计算密集型程序的阻塞系数为0，IO密集型程序的阻塞系数接近1。确定阻塞系数，我们可以先试着猜测，或者采用一些性能分析工具或 java.lang.management API 来确定线程华仔系统IO上的时间与CPU密集任务所耗的时间比值。")]),t._v(" "),t._m(19),t._v(" "),a("p",[t._v("工具类，提供大量管理线程执行器的工厂方法。")]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),a("p",[t._v("用于异步获取执行结果或取消执行任务。通过传入Callable给FutureTask，直接调用run方法执行，之后可以通过FutureTask的get异步方法获得执行结果。FutureTask即使多次调用了run方法，它智慧执行一次Callable任务，当然也可以通过cancel来取消执行。")]),t._v(" "),t._m(24),t._v(" "),a("p",[t._v("基于数组、先进先出、线程安全的集合。")]),t._v(" "),t._m(25),t._v(" "),a("p",[t._v("线程安全，读操作时无锁的ArrayList。每次新增一个对象时，会将创建一个新的数组（长度+1），将之前的数组中的内容复制到新的数组中，并将新增的对象放入数组末尾。最后做引用切换。")]),t._v(" "),t._m(26),t._v(" "),a("p",[t._v("与上面的CopyOnWriteArrayList类似，区别在于add元素时，会调用addIfAbsent，由于每次add时都要进行数组遍历，因此性能会略低于CopyOnWriteArrayList。")]),t._v(" "),t._m(27),t._v(" "),a("p",[t._v("单锁。控制并发的，和synchronized达到的效果是一致的。lock方法，借助于CAS机制来控制锁。unlock方法，释放锁。")]),t._v(" "),t._m(28),t._v(" "),a("p",[t._v("与ReentrantReadWriteLock没有任何继承关系，提供了读锁和写锁，在读多写少的场景中大幅度提升性能。")]),t._v(" "),a("p",[t._v("持有读锁时，不能直接调用写锁的lock方法；持有写锁时，其它线程的读或写都会被阻塞。")]),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"jdk并发包里常用的类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jdk并发包里常用的类","aria-hidden":"true"}},[this._v("#")]),this._v(" JDK并发包里常用的类")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("资料：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"concurrenthashmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#concurrenthashmap","aria-hidden":"true"}},[this._v("#")]),this._v(" ConcurrentHashMap")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/images/JDK%E5%B9%B6%E5%8F%91%E5%8C%85%E9%87%8C%E5%B8%B8%E7%94%A8%E7%9A%84%E7%B1%BB/concurrent-hash-map.png",alt:"concurrent-hash-map"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"semaphore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#semaphore","aria-hidden":"true"}},[this._v("#")]),this._v(" Semaphore")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("tryAcquire方法，获得锁"),s("br"),this._v("\nrelease方法，释放锁")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"countdownlatch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#countdownlatch","aria-hidden":"true"}},[this._v("#")]),this._v(" CountdownLatch")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"cyclicbarrier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cyclicbarrier","aria-hidden":"true"}},[this._v("#")]),this._v(" CyclicBarrier")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-Java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concurrent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CyclicBarrier"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestCyclicBarrier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" THREAD_NUM "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WorkerThread")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        CyclicBarrier barrier"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WorkerThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CyclicBarrier b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("barrier "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Worker\'s waiting"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 线程在这里等待，直到所有线程都到达barrier。")]),t._v("\n                barrier"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" Thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" Working"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        CyclicBarrier cb "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CyclicBarrier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("THREAD_NUM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当所有线程到达barrier时执行")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Inside Barrier"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WorkerThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Worker's waiting\nWorker's waiting\nWorker's waiting\nWorker's waiting\nWorker's waiting\nInside Barrier\nID:13 Working\nID:9 Working\nID:12 Working\nID:11 Working\nID:10 Working\nWorker's waiting\nWorker's waiting\nWorker's waiting\nWorker's waiting\nWorker's waiting\nInside Barrier\nID:18 Working\nID:14 Working\nID:16 Working\nID:15 Working\nID:17 Working\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"atomicinteger"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#atomicinteger","aria-hidden":"true"}},[this._v("#")]),this._v(" AtomicInteger")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"threadpoolexecutor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#threadpoolexecutor","aria-hidden":"true"}},[this._v("#")]),this._v(" ThreadPoolExecutor")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("corePoolSize： 线程池维护线程的最少数量\nmaximumPoolSize：线程池维护线程的最大数量\nkeepAliveTime： 线程池维护线程所允许的空闲时间\nunit： 线程池维护线程所允许的空闲时间的单位\nworkQueue： 线程池所使用的缓冲队列\nhandler： 线程池对拒绝任务的处理策略\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("ArrayBlockingQueue：有界的数组队列")]),this._v(" "),s("li",[this._v("LinkedBlockingQueue：可支持有界、无界的队列，使用链表实现")]),this._v(" "),s("li",[this._v("PriorityBlockingQueue：优先队列，可对任务排序")]),this._v(" "),s("li",[this._v("SynchronousQueue：队列长度为1的队列，和Array有点区别就是：client 线程提交到 block queue会是一个阻塞过程，直到有一个消费线程连接上来poll task")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("Reject 直接抛出Reject exception")]),this._v(" "),s("li",[this._v("Discard 直接忽略该runnable，不建议使用")]),this._v(" "),s("li",[this._v("DiscardOldest 丢弃最早入队列的任务")]),this._v(" "),s("li",[this._v("CallerRuns 直接让原先的client thread做为消费线程，象同步调用方式一样，自己来执行。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/images/JDK%E5%B9%B6%E5%8F%91%E5%8C%85%E9%87%8C%E5%B8%B8%E7%94%A8%E7%9A%84%E7%B1%BB/threadpool-flow.png",alt:"threadpool-flow"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("如何确定最大线程数？")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Runtime.getRuntime().availableProcessors();")]),this._v(" 应用程序最小线程数应该等于可用的处理器核数。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("线程数 = CPU可用核心数 / (1- 阻塞系数)")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"executors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#executors","aria-hidden":"true"}},[this._v("#")]),this._v(" Executors")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("newFixedThreadPool(int)")]),this._v("，创建固定大小的线程池。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("newSingleThreadPool()")]),this._v("，创建大小为1的线程池，同一时刻执行的task只有一个，其它的都放在阻塞队列中。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("newScheduledThreadPool(int)")]),this._v("，适用于一些需要定时或延迟的任务。与Timer的区别：Timer时单线程，一旦一个task执行慢，将会影响其它任务。另外如果抛出异常，其它任务也不再执行。ScheduledThreadPoolExecutor可执行Callable的task，执行完毕后得到执行结果。任务队列时基于DelayedWorkQueue实现，将有新task加入时，会按执行时间排序。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"futuretask"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#futuretask","aria-hidden":"true"}},[this._v("#")]),this._v(" FutureTask")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"arrayblockingqueue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arrayblockingqueue","aria-hidden":"true"}},[this._v("#")]),this._v(" ArrayBlockingQueue")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"copyonwritearraylist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copyonwritearraylist","aria-hidden":"true"}},[this._v("#")]),this._v(" CopyOnWriteArrayList")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"copyonwritearrayset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copyonwritearrayset","aria-hidden":"true"}},[this._v("#")]),this._v(" CopyOnWriteArraySet")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"reentrantlock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock","aria-hidden":"true"}},[this._v("#")]),this._v(" ReentrantLock")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"reentrantreadwritelock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock","aria-hidden":"true"}},[this._v("#")]),this._v(" ReentrantReadWriteLock")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-Java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("ReentrantReadWriteLock lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nWriteLock writeLock "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wirteLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\nReadLock readLock "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"如何避免死锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免死锁","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何避免死锁")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("指定锁的顺序，来避免死锁（先A后B，避免A->B和B->A同时存在）")]),this._v(" "),s("li",[this._v("尝试使用定时锁（lock.tryLock(timeout))")]),this._v(" "),s("li",[this._v("在持有锁的方法中进行其他方法的调用，尽量使用开放调用（当调用方法不需要持有锁时，叫做开放调用）")]),this._v(" "),s("li",[this._v("减少锁的持有时间、减小锁代码块的粒度")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#汇总","aria-hidden":"true"}},[this._v("#")]),this._v(" 汇总")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/images/JDK%E5%B9%B6%E5%8F%91%E5%8C%85%E9%87%8C%E5%B8%B8%E7%94%A8%E7%9A%84%E7%B1%BB/concurrent-summary.png",alt:"concurrent-summary"}})])}],!1,null,null,null);s.default=e.exports}}]);